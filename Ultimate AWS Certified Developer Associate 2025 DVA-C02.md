
https://www.stephanemaarek.com/

Code and Slides:
- https://courses.datacumulus.com/downloads/certified-developer-k92
- [5 Practice Exams](https://links.datacumulus.com/aws-certified-dev-pt-coupon?_gl=1*iek650*_ga*MTk4NTM1MjE1MS4xNzQ3Nzg3NDM1*_ga_6GZZTGGX7H*czE3NDgyMTA0NjgkbzIkZzAkdDE3NDgyMTA0NjgkajYwJGwwJGgwJGRtVFNYeXgxYUVsMFBMUG1iYV84RVFVS3F1YzdZTUI1M3BR)
- https://courses.datacumulus.com/mailing-list/
- 

------  
  
- See credential notes for your access key

------


aws.amazon.com
1) Specify a Root User Email Address and an Account Name


https://infrastructure.aws

### AWS Region (e.g., us-east-2)
- A region is a cluster of data centers
-  most services are -region-scoped
	- E.g., EC2, Lambda, and Rekognition
- How should you choose a region?
	- Compliance
		- There may be limitations on where data is stored.
	- Latency
		- Proximity allows for reduced latency
	- Available Services
		- New services and features aren't available in all regions
		- List of Services by Region: https://aws.amazon.com/about-aws/global-infrastructure/regional-product-services/
	- Pricing
		- Varies with each region

### AWS Availability Zones
- Each region has as few as 3, and as many as 6, availability zones in each Region.
	- E.g., us-east-1a, us-east-1b, us-east-1c
- Each Availability Zone consists of 1 or more Data Centers.
- Availability Zones' locations are selected to prevent a natural disaster from disrupting service at more than one Data Center.

AWS Points of Presence (Edge Locations)
- Amazon has 400+ Points of Presence (400+ Edge Location & 10+ Regional Caches) in 90+ cities across 40+ countries to deliver content with low latency.

# Section 4:  IAM: Users & Groups

## Identity & Access Management (IAM)
- A global service
- Root account
- Users are people within your organization that can be grouped.
- Users don't need to belong to groups
- Users may belong to multiple groups
- A region may not be selected for IAM because it is a global service.


## Create Non-Root Admin Users
1. In the AWS Console, search for IAM.
2. In the left pane, select Users.
3. Clink on the Create User button at the top right of the screen.
4. Give the user a name
5. Click the checkbox to provide the user access to the AWS Console.
6. Select "I want to create an IAM user" (It's the easier option for now)
7. Specify a password or use an autogenerated password.
8. Click Next to move onto the next screen.
9. Select the "Add User to a Group" radio button.
10. Click on the Create Group button (because we don't have any groups yet)
11. Give the group a name (Use `admin` for the lesson)
12. Select the checkbox for the `AdministratorAccess` Policy Name. 
13. Click Next to move onto the next screen.
14. (optional) You may add tags to the user.
	1. E.g., (key: "Department", value: "Engineer")
15. Click on the Create User button.
## Verify the User's Access
- Return to the Users list.
- Select `User groups` under Access Management in the left pane.
- Click on the `admin` group name.
- The user name should appear in the list of users in the group.
- Click on the user name.
- The `AdministratorAccess` should appear under the user's list of Permissions Policies.
- In the `Attached Via` column, you should see "Group Admin", which means that the `AdministratorAccess` permissions policy was inherited via the `admin` group.

### IAM Dashboard
- The AWS Account Sign-In URL defaults to:
	- `https://<Account ID Number>.signin.aws.amazon.com/console`
- An Account Alias may be set to replace the Account ID in the URL via the IAM Dashboard:
	- AWS Console --> IAM --> Dashboard --> AWS Account --> Account Alias --> Create
		- `https://<Account Alias>.signin.aws.amazon.com/console`
		- E.g., using `bianco` as the alias:
			- https://bianco.signin.aws.amazon.com/console
- If you don't see the `IAM user` along with the `Account ID` when selecting the user settings menu at the top right of the screen, then you're logged in as the root user.
- You'll need to contact Amazon if you lose your AWS root user password.

> Use your IAM credentials for this course rather than the root user credentials.

## IAM Policy Inheritance

### Group Policies
- Policies applied to members of groups
- Groups only contain users
### Inline Policies
- Policies applies to users

### IAM Policies Structure

Policies are JSON documents that consist of:
- a version number
- Id (optional)
- 1 or more statements, consisting of
	- **Sid**: a Statement Identifier (optional).
	- **Effect**: Whether the statement allows or denies access (Allow/Deny).
	- **Principal**: Account/User/Role to which this policy applies.
	- **Action**: list of actions that this policy allows/denies.
	- **Resource**: list of resources to which the actions will be applied.
	- **Condition**: Conditions for when the policy is in effect (optional)
```json
{
	"Version": "2012-10-17",
	"Id": "S3-Account-Permission",
	"Statement": [
		{
			"Sid": "1",
			"Effect": "Allow",
			"Principal": {
				"AWS": ["arn:aws:iam::123456789012:root"]
			},
			"Action": [
				"s3:GetObject",
				"s3:PutObject"
			],
			"Resource": ["arn:aws:s3::mybucket/*"]
		}
	]
}
```

### View Policy Structure
AWS Console --> IAM --> Policies ->  (select a policy name) --> Permissions --> Select the JSON View.

Asterisk after actions (e.g., `iam:Get*` or `iam:List*`) serve as a wildcards that references all actions that begin with the text before the asterisk for the specified resource (e.g., for IAM Get and List actions in the example below).
```json
{
	"Version": "2012-10-17",
	"Statement": [
		{
			"Effect": "Allow",
			"Action": [
				"iam:Get*",
				"iam:List*"
			],
			"Resource": ["*"]
		}
	]
}
```


### IAM Password Policy
- Minimum password length
- Require specific character types:
	- include uppercase
	- include lowercase
	- numbers
	- non-alphanumeric
- Allow IAM users to change their own passwords.
- Require users to change their password after some time (password expiration)
- Require multi-factor authentication (MFA).

#### Set a Password Policy
AWS Console -> IAM -> Account Settings -> Password Policy -> Edit


### AWS Access Key, CLI, and SDK
Install the AWS CLI on your platform (Windows, Linux, Apple)
- https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html
- Verify installation: `aws --version`

#### Create a CLI Access Key
1. AWS Console -> IAM -> Users -> (user) -> Security credentials -> Access keys -> Create access key
2. Select Command Line Interface (CLI)
3. Click Next
4. Skip to Create access key (you don't need to add tags at this stage in the course)

In your CLI:
- Run `aws configure`, and enter the following in the prompts:
	- AWS Access Key ID: Enter your access key
	- AWS Secret Access Key: Enter your secret access key
	- Default region name: Enter the region you will use (e.g., `us-east-1` for N. Virginia)
	- Default output format: You may leave this blank

#### Test the CLI is working
- Run `aws iam list-users`
- Assuming we added the iam:List* permissions above, the terminal will return a list of AWS account users under our AWS account.

### AWS CloudShell
A terminal in the AWS Console (accessed within the browser)
- The logged in user's credentials are automatically applied when running aws commands in CloudShell.
- Files and variables that you create in the CloudShell persist (Really!?)
To download a file from CloudShell:
- Run the `pwd` command to get the working directory
- Click on the Actions menu at the top right of CloudShell
- Click download.
- Enter the path to the file in the prompt.

### IAM Roles for Services
An IAM Role is an IAM entity that defines a set of permission for making requests to AWS services, and will be used by an AWS service.

Some AWS services will need to perform actions on your behalf. To do this, we assign permissions to the AWS services with IAM Roles.

1. AWS Console -> IAM -> Roles -> Create Role -> AWS Service
2. Select a `Service or use case` to select the service the IAM Role should apply to.
	1. For this example, select `EC2` to allow EC2 to instances to call AWS services on your behalf. Note for this example: Select the general EC2 use case option, not any of the more specific EC2  options.
3. Attach a permissions policy.
	1. For this example, add IAMReadOnlyAccess to give the EC2 instance read-only access to IAM.
4. On the next screen:
	1. Give the role a name (e.g., DemoRoleForEC2).
	2. The Trust Policy section confirms that the service (e.g., "ec2.amazonaws.com") can assume the role being defined (See example Trust Policy JSON object below).
	3. The Add Permissions section confirms the permissions that will be applied to the new role.
5. Click on Create role.
```JSON
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "sts:AssumeRole"
            ],
            "Principal": {
                "Service": [
                    "ec2.amazonaws.com"
                ]
            }
        }
    ]
}
```


## Subsection 26. IAM Security Tools

IAM Credentials Report (Account-level)
- Lists all your accounts users and statuses of their various credentials.
- The report will contain information pertaining to the user name, arn, user_creation_time, password, mfa, access_keys, and certs

IAM Access Advisor / Last Accessed (user-level)
- Shows the service permissions granted to a user and when those services were last accessed.
- `IAM Access Advisor` was renamed to `Last Accessed`

## Subsection 27. IAM Security Tools Hands on

### Creating a Credentials Report
1. AWS Console > IAM > Credential Report
2. Click on Download credential report.

### IAM Access Advisor / Last Accessed
1. AWS Console > IAM > User > (Click on a user's name)
2. Under the Allowed Services section:
	1. Services that are in a black font were never accessed by the users.
	2. The names of services that a user accessed will appear as hyperlinks that link to a page that shows when each of the service's actions were last accessed.
	3. The granting permissions that were used to access the services will be listed alongside each service.

## Subsection 28. IAM Guidelines & Best Practices

- DON'T USE THE ROOT ACCOUNT EXCEPT FOR ACCOUNT CREATION!!!
- 1 Physical user = 1 AWS User
- Assign users to groups and assign permissions to groups.
- Create a strong password policy.
- Use and enforce multi-factor authentication (MFA).
- Create and use Roles when giving permissions to AWS services.
- Use Access Keys for Programmatic Access (CLI/SDK)
- Audit permissions of your account using IAM Credentials Report & IAM Access Advisor/Last Access.
- Never share IAM user and access keys


## Subsection 29. Shared Responsibility Model for IAM

In short, AWS is responsible for the infrastructure, and you're responsible for how you use the infrastructure.

| AWS' Responsibility                      | Your Responsibility                                          |
| ---------------------------------------- | ------------------------------------------------------------ |
| Infrastructure (Global Network Security) | Creating users, groups, policies management, and monitoring. |
| Configuration and culnerability analysis | Enabling MFA on all accounts                                 |
| Compliance validation                    | Rotating all keys often                                      |
|                                          | Using IAM tools to apply appropriate permissions             |
|                                          | Analyze access patterns & review permissions                 |

# Section 5: EC2 Fundamentals
## Subsection 31: AWS Budget Setup

To access Billing and Cost Management:
- AWS Console > Click on you account name (top right of the browser) > select "Billing and Cost Management" from the drop-down menu.
- Access will be denied to users until/unless they are given permission.
	- AdministratorAccess is not enough to view billing information.

To allow access to billing information to administrators:
-  AWS Console > Click on you account name (top right of the browser) > select "Account" from the drop-down menu.
- Scroll down to the "IAM user and role access to Billing information" section.
- Activate IAM Access.

### Creating a Budget
Budgets can be created to alert you when you cross cost thresholds.

- AWS Console > Click on you account name (top right of the browser) > select "Billing and Cost Management" from the drop-down menu.
- Select "Budgets" from the left-side menu.
- Click on Create budget.
- In the Budget Setup section, select "Use a Template" for this example.
- Give the budget a name.
- Enter the threshold budget amount.
- Enter at least one recipient's email address.
- Click Create budget.

## Subsection 32: EC2 Basics

Elastic Compute Cloud
Infrastructure as a Service

EC2 is not just one service, it's composed of many services.

May be used to:
- Rent virtual machines called EC2 Instances.
- Store data on virtual drives (Elastic Block Store (EBS))
- Distribute loads across machines (Elastic Load Balancer (ELB))
- Scale service using an Auto-Scaling Group (ASG)

EC2 Sizing & Configuration Options:
- Operating System: Linux, Windows, Mac OS
- Compute Power & Cores (CPU)
- Memory: RAM
- Storage Space:
	- Network-attached (EBS & EFS)
	- Hardware-attached (EC2 Instance Store)
- Network Card: Speed of the card, Public IP address.
- Firewall Rules: Security Group
- Bootstrap Script (configure at first launch): EC2 User Data

### EC2 User Data
It's possible to bootstrap our instances using an EC2 User Data script.
**Bootstrapping**: Launching commands when a machine starts. This script only runs once upon startup.
EC2 user data is used to automate boot tasks such as:
- Installing updates
- Installing software
- Downloading common files from the internet
- Anything else...
**USER DATA SCRIPTS RUN WITH THE ROOT USER  (I.E., SUDO PERMISSIONS)**


## Subsection 33: Create an EC2 instance with EC2 User Data for a Website
- We'll launch our first virtual server using EC2 user data via the AWS Console

1. Launch an EC2 Instance
	1. AWS Console > EC2 > Click on Launch Instances.
	2. Give the instance a name (you may also give the EC2 instance additional tags here).
	3. Select an Application and OS Image 
		1. We'll use the (Free tier eligible) Amazon Linux 2023 (Amazon Machine Image) AMI for this example.
	4. Under Architecture, select `64-bit (x86)`.
	5. Select an Instance Type (select a Free tier eligible type such as t2.micro)
	6. Select or Create a Key Pair to log into your instance.
		1. Give the Key Pair a name
		2. Select an encryption type
		3. Private Key File Format: For <Windows 10, select .ppk, else select .pem for use with OpenSSH.
			1. Don't include spaces in Private Key (PEM) file names.
			2. In Linux/MacOS, set the key's permissions by running `chmod 0400 <Path to Private Key File>`
			3. In Windows (Ensure the windows user is the owner of the file.):
				1. right click on the private key file
				2. select properties
				3. go to the security tab
				4. click the Advanced button
				5. If the Owner isn't the current Windows user and isn't listed in the permission entries list, click on the Change link to the right of the listed Owner.
				6. enter the current user's username as the "object name to select" and click OK.
				7. Other users may be removed from the permission entries list. You'll need to select the SYSTEM entry and click on the Disable Inheritance button to remove all inheritance from the object.
				8. Add under the permissions entries list.
				9. Click on the Select a principal link in the window that pops up.
				10. In the Select User or Group window that opens, enter the Windows user's username in the textbox and click Check Names to ensure the name is found in the system.
				11. In the Permission Entry for \<key file name\> window, select Full control and click OK.
					1. The user will be listed as the Owner and the principal as well.
				12. Click OK in the Advanced Security Settings for \<key file name\> window and again in the File Properties window.
	7. Network security rules:
		1. allow SSH traffic from anywhere.
		2. allow HTTP traffic from the internet.
		3. (We're not setting up HTTPS for this sample website).
	8. Leave the storage configuration in default settings (8Gib gp3 Root Volume).
		1. Note: if you click on "Advanced" in this EBS Volumes section and expand the Volume data, you'll see the "Delete on Termination" option, which causes volumes to automatically delete upon termination. The default option is "Yes" to delete upon termination.
	9. We're skipping most of the Advanced section for now, except for the User Data section. 
		1. This is where we'll place a script (see below User Data Script from the code_v2025-02-23/ec2-fundamentals/ec2-user-data.sh course materials file) that executes on first launch of the instance.
	10. The Summary section will confirm the default number of instances, 1, will be launched.
	11. Click `Launch instance`.
	12. In the list of EC2 Instances, select the instance and navigate to the Public IPv4 address listed in the instance's Details section.

NOTE: If you stop and start the instance, the instance's public IP address will change!!! The private IP address will not change.

User Data Script
```bash
#!/bin/bash
# Use this for your user data (script from top to bottom)
# install httpd (Linux 2 version)
yum update -y
yum install -y httpd
systemctl start httpd
systemctl enable httpd
echo "<h1>Hello World from $(hostname -f)</h1>" > /var/www/html/index.html
```

## Subsection 34: EC2 Instance Types Basics

Website comparing different instances:
- https://instances.vantage.sh

Different types of instance (e.g., General Purpose, Compute Optimized, Memory Optimized, etc.)

Each instance type has different families.
### How to interpret instance types

| m5.2xlarge |                                     |
| ---------- | ----------------------------------- |
| m          | Instance Class                      |
| 5          | Generation (AWS improves over time) |
| 2xlarge    | Size within the instance class      |
### Benefits of (some) different instance types

- General Purpose
	- Great for web servers or code repositories.
- Compute Optimized
	- Batch processing workloads
	- Media transcoding
	- High performance web servers
	- High performance computing (HPC)
	- Scientific modeling & machine learning
	- Dedicated gaming servers
- Memory Optimized
	- High performance, relational/non-relational databases
	- Distributed web scale cache stores
	- In-memory database optimized for BI (Business Intelligence)
	- Applications performing real-time processing of big unstructured data.
	- Recommended for critical applications that uses an in-memory database
- Storage Optimized
	- High-frequency online transaction processing (OLTP) systems
	- relational/NoSQL databases
	- Cache for in-memory databases (E.g., Redis)
	- Data warehousing applications
	- Distributed file systems

## Subsection 35. Security Groups & Classic Ports Overview

### Security Groups
- AWS Console > EC2 > Security Groups (or within each EC2 instance's security tab)
- control how traffic is allowed into (inbound) and out of (outbound) our EC2 instances.
- only include allow rules.
- Are locked down to a specific region and VPC.
- Rules can reference by IP or by security group (i.e., groups can reference each other)
- Act like "firewalls" on EC2 instances
- regulate: 
	- access to ports
	- authorized IP ranges: IPv4 and IPv6
- It's good practice to maintain a separate security group for SSH access.
- If your application is not accessible due to a **time out**, it's a security group issue.
- If your application responds with a "connection refused" error, then it's an application error or not launched.
- EC2 Instances that share security groups may connect to each other directly (using specific ports?).

Example:

| Type | Protocol | Port Range | Source    | Description    |
| ---- | -------- | ---------- | --------- | -------------- |
| HTTP | TCP      | 80         | 0.0.0.0/0 | test http page |
A source, `0.0.0.0/0`, means that incoming traffic from anywhere.


### Important port numbers:

| Port Number | Purpose                              | Description                    |
| ----------- | ------------------------------------ | ------------------------------ |
| 22          | SSH (Secure Shell)                   | Log into a Linux instance      |
| 21          | FTP (File Transfer Protocol)         | Upload files into a file share |
| 22          | SFTP (Secure File Transfer Protocol) | Upload files using SSH         |
| 80          | HTTP                                 | Access unsecured websites      |
| 443         | HTTPS                                | Access secured websites        |
| 3389        | RDP (Remote Desktop Protocol)        | Log into a Windows instance    |

### To add an inbound rule to a Security Group:
1. Select a Security Group.
2. Click on "Edit inbound rules" in the Inbound Rules section.
3. Click on "Add rule".
4. Select a Type for the rule (e.g., HTTP).
5. Select a Port Range (E.g., 80 for HTTP).
6. Select a Source (E.g., Anywhere-IPv4) or enter a source in the textbox.
7. Optionally provide a description.
8. Save the changes to the security group rules.

## Subsection 38. How to SSH using Linux or Mac
Instructions for how to SSH into an EC2 instance using Linux, Mac, or Windows 11+.

NOTE: ==NEVER STORE/ENTER YOUR AWS CREDENTIALS IN AN EC2 INSTANCE.==
- E.g., Don't SSH into an instance and set the `aws config`.
- Other users that SSH into the instance will have access to the credentials.
- Use an IAM Role for access to AWS within an instance (See Subsection 43. EC2 Instance Roles Demo) 

1. Create a Private Key (PEM) file (see subsection 33).
2. Get the EC2 instance's public IPv4 address. (Currently 54.159.198.181)
3. In a terminal, run `ssh -i <path to private key> <User name>@<IP address or URL>`
	1. The Amazon Linux 2023 AMI creates a user, ec2-user, that may be used for connecting via SSH.  e.g., `ssh -i EC2-Tutorial.pem ec2-user@54.159.198.181`
	2. If you're asked whether you're sure that you'd like to connect, respond "yes".

## Subsection 42. EC2 Instance Connect
May be used as an alternative to SSH
1. AWS Console > EC2 > Instances > Select an Instance > Click Connect at the top of the screen.
	1. NOTE: If you don't have inbound security rules for SSH ports (IPv4 or IVv6), Instance Connect won't be able to connect to the instance.
2. Select Connect using EC2 Instance Connect
3. (Optional) Set the username (The default username is auto-populated)
4. Click Connect

## Subsection 43. EC2 Instance Roles Demo

1. Go to AWS Console > EC2 > Instances
2. Check the box to select an EC2 instance
3. Click on the Actions menu at the top of the window.
4. Select Security > Modify IAM role
5. Choose an IAM role.
6. Click on Update IAM role.

E.g., If you applied an IAMReadOnlyAccess permission, via a role, to an EC2 instance, you'll be able to run `aws ec2 list-users` within the instance.

## Subsection 44. EC2 Instance Purchasing Options

### On-demand Instances: 
Recommended for short-term and un-interrupted workloads, where you can't predict how the application will behave.
- Short workloads.
- Predictable pricing.
- Highest cost, but no upfront payment
- No long-term commitment.
- Pay by the second for Linux or Windows
- Pay by the hour for other operating systems

### Reserved (1 or 3 year terms)
Recommended for steady-state usage applications (e.g., databases)
- Up to 72% discount compared to On-demand Instances.
- Long workloads.
- Reserve a specific instance attribute (e.g., Type, Region, Tenancy, OS).
- Payment Options (No upfront, partial upfront, all upfront).
- Scope: May be scoped to a Region or Zonal (reserve capacity in an AZ).
- Reserved Instance Marketplace: Buy and sell reserved instances.
- Convertible Reserved Instances: 
	- The type, family, OS, scope, and tenancy may be changed.
	- Long workloads with flexible instances.
	- Up to 66% discount.

### Savings Plan (1 or 3 year terms):
- Commitment to an amount of usage (in dollars) instead of committing to an instance type, long workloads.
- Get a discount based on long-term usage (up to 72%).
- Commit to a certain type of usage (e.g., $10/hour for 1 or 3 years)
- Usage beyond the EC2 Savings Plan allocation is billed at On-demand pricing.
- Locked to a specific family and Region (e.g., m5 in us-east-1).
- Flexible across:
	- Instance Size (e.g., m5.xlarge, m5.2xlarge)
	- OS
	- Tenancy (e.g., Host, Dedicated, default)
### Spot Instances:
- Up to 90% discount compared to On-demand.
- Not suitable for critical jobs or databases.
- Useful for workloads that are resilient to failure, such as:
	- Batch jobs
	- Data analysis
	- Image processing
	- Distributed workloads
- Short workloads, cheap, can lose instances (less reliable).
- You specify the maximum price you're willing to pay, and you'll lose the instance if the spot price rises above your maximum price.
- Most cost-efficient instances in AWS
### Dedicated Hosts:
- Book an entire physical server.
- Control instance placement.
- Allows you to use existing server-bound software licenses (e.g., per-socket, per-core, etc.)
	- Bring Your Own License (BYOL)
- Purchasing Options:
	- On-demand: pay per second for active, Dedicated host.
	- Reserved (up to 72% discount): 1 or 3 years (No Upfront, Partial Upfront, All Upfront)
- Most expensive option.
- Recommended for entities that have strong regulatory or compliance needs.
### Dedicated Instances:
- No other customers will share your hardware.
- May share hardware with other instances in same account.
- No control over instance placement (placement may change upon instance Stop/Start).
### Capacity Reservations
Recommended for short-term, uninterrupted workloads that need to be in a specific AZ.
- Reserve capacity in a specific AZ for any duration.
- No billing discounts if no time commitment (create/cancel anytime).
- May be combined with Regional Reserved Instances and Savings Plans to benefit from billing discounts.
- You're charged regardless of usage.

### Analogies
On-demand Instances:
- Book at the last minute and pay full price.
Reserved:
- Get a discount for reserving services over a long period.
Savings Plan:
- You know you're going to spend a certain amount every month, but may want to change the room type over time. You're willing to commit to spending an amount every month.
Spot Instances:
- You get a heavily discounted price, but get kicked out of a room if someone's willing to pay more than you.
Dedicated Hosts:
- Book the entire building of a resort.
Dedicated Instances:
- 
Capacity Reservations
- Book a room for a period for the full price, even if you don't use it.

## Subsection 45. IP Address Charges in AWS
- There's a charge for all Public IPv4 addresses in your account, regardless of whether they're used.
- ~ $.005 per hour of Public IPv4 (~$3.6 per month)
- IPv6 addresses are free, but not available everywhere yet. 
### Troubleshooting AWS Bill
- Look into AWS Public IP Insights Service 
- https://repost.aws/articles/ARknH_OR0cTvqoTfJrVGaB8A/why-am-i-seeing-charges-for-public-ipv4-addresses-when-i-am-under-the-aws-free-tier
- IPv4 charges will appear under the "...charges by service" list in Billing and Cost Management > Bills.

### List IP Addresses
1. Search for IPAM in the AWS Console.
2. Go to the Amazon VPC IP Address Manager
3. Click on Public IP insights on the left pane.
4. Click on Create IPAM.
5. Allow data replication
6. Select Free Tier as the IPAM Tier for this course.
7. In the IPAM Settings, select all regions in Operating regions.
8. 

# Section 6: EC2 Instance Storage
## Subsection 46. EBS Overview

An Elastic Block Store (EBS) volume is a network drive you can attach to your instances while they run.
EBS Volumes allow data to persist, even after terminating EC2 instances.
Locked to one Availability Zone (AZ): Mounted EBS volumes are bound to one AZ and must be in the same AZ as the EC2 instance it's mounted to.
- You may create a snapshot of an EBS volume to move a volume to another AZ by moving the  snapshot and creating a volume based on the snapshot.
May think of EBS volumes as "Network USB stick" that can be used on any computer.
(2025) Free Tier allows 30 GB of free EBS General Purpose (SSD) or Magnetic storage per month.
A network is used, so there may be some latency.
Can be detached from one instance and attached to another instance quickly (great for fail-overs).
You need to provision the capacity (e.g., size in GB and I/O Operations Per Second (IOPS)).
- You will be billed for this capacity.
- You may change the capacity over time.

==This will be on the cert exam==
- EBS volumes may be configured to delete upon termination of their EC2 instances.
	- By default, root volumes are set to delete upon termination.
	- By default, EBS volumes are not set to delete upon termination.
	- Defaults may be set via the AWS Console or AWS CLI.
	- Use-case: If you want to preserve root volume when an instance is terminated.

## Subsection 47. EBS Hands On

### Create an EBS Volue:
1. Go to AWS Console > EC2 > Volumes
2. Click on `Create volume`
3. Select a volume type (e.g. General Purpose SSD (gp2))
4. Select a size (e.g., 2GiB)
5. Select the availability zone of EC2 instances to which you expect to connect the volume.
6. You may skip other sections and click on `Create volume`.
You may need to refresh the list of volumes to see a newly created volume.
The volume will be ready for use when its `Volume state` becomes `Available`.

### Attach a volume to an instance:
These instructions don't show you how to also use the volume once it's attached. Search for "Make an EBS volume available for use on Linux" for further instructions.

1. Go to AWS Console > EC2 > Volumes
2. Select a volume
3. Click on `Actions` at the top right of the Volumes page.
4. Select `Attach volume` from the dropdown menu.
5. In the Attach volume page, select the instance you want to connect the volume to.
6. Select a `Device name`. 
	1. `/dev/sdf` is entered as the device name, but as of 2025-07-05, I get the following warning: "Newer Linux kernels may rename your devices to **/dev/xvdf** through **/dev/xvdp** internally, even when the device name entered here (and shown in the details) is **/dev/sdf** through **/dev/sdp.**"
You may confirm that a volume is attached to an instance by checking whether the volume is listed in the instance's `Storage` tab under AWS Console > EC2 > Instances > {instance}.

## Subsection 48. EBS Snapshots
You may make a backup (snapshot) of your volumes at any point in time.
It's recommended to detach volumes when creating snapshots.
Snapshots can be copied to different AZs and AWS regions.
EBS Snapshot Archive:
- Move a snapshot to an "archive tier" that is 75% cheaper.
- Will take 24-72 hours to restore from the archive.
Recycle Bin for EBS Snapshots
- Setup rules to retain snapshots so you can recover them after an accidental deletion.
- Specify retention (from 1 day to 1 year)
Fast Snapshot Restore
- Force full initialization of snapshot to have no latency on the first use (This is expensive).

## Subsection 49. EBS Snapshots Hands On

### Create a snapshot
1. Go to AWS Console > EC2 > Volumes
2. Select a volume.
3. Actions menu > Create snapshot
4. Enter a description.
5. Click on Create Snapshot.

### Copy a snapshot into another region
1. Go to AWS Console > EC2 > Snapshots
2. Select a snapshot
3. Actions menu > Copy snapshot
4. Select a region to copy the snapshot to
5. Click on Copy Snapshot

### Create a volume from a snapshot
1. Go to AWS Console > EC2 > Snapshots
2. Select a snapshot
3. Actions menu > Create a volume from snapshot
4. ...

### Recycle Bin
Go to AWS Console > EC2 > Snapshots > Recycle Bin button


## Subsection 50. AMI Overview

Amazon Machine Image:
- A customized EC2 instance.
- You can add (pre-package) your own software, configuration, operating system, monitoring.
- Are built for a specific region, but ==may be copied to other regions==.
- you may launch EC2 instances from:
	- A Public AMI: AWS provided.
		- E.g., Amazon Linux 2 AMI or the Amazon Linux 2023 AMI
	- Your own AMI:
		- you make and maintain them yourself.
	- An AWS Marketplace AMI
		- An AMI someone else made (and potentially sells)

AMI Process (from an EC2 Instance)
- Start an EC2 instance and customize it
- Stop the instance (for data integrity)
- Build and AMI - this will also create EBS snapshots
- Launch instances from other AMIs


## Subsection 51. AMI Hands on

### Example for how to create an AMI
 #### First, create and configure an instance
1. Go to AWS Console > EC2 > Launch instances button
2. Select an AMI
3. Select an instance type
4. Select network settings
	1. We'll use the launch-wizard-1 security group for the class.
5. Configure storage
6. Add the following User data in the advances
	1. Everything except for creating an index.html file is copied from the example in subsection 33.
7. Click on Launch instance

It will take some time for the instance to start up the first time.

```bash
#!/bin/bash
# Use this for your user data (script from top to bottom)
# install httpd (Linux 2 version)
yum update -y
yum install -y httpd
systemctl start httpd
systemctl enable httpd
```

#### Next, create an image from the current state of the instance
1. Go to AWS Console > EC2 > right click on the instance's row in the Instances list.
2. Select `Image and templates` from the right-click menu.
3. Select `Create image` from the submenu.
4. Give the image a name.
5. You may leave all other configurations as they are for now
6. Click on `Create image`.
7. Wait for the new AMI to change state from `pending` to `Available`.
	1. The image will be in a pending state for a few minutes.
#### Confirm the image is created
1. Go to AWS Console > EC2 > AMIs (from the left panel, under Images)
2. The AMI you created should be listed in the list of AMIs

### Launch your custom AMI
- When launching an instance, select the `My AMIs` tab in the `Application and OS Images (Amazon Machine Image)` section.
- Your custom AMI will be listed as an AMI from which you may create an instance.

For example, if you use the AMI we created in this section to launch an EC2 instance, you only need to add the following four lines in the `User data` section to achieve the same result as the instance created in subsection 33 (i.e., we can save a few steps by using custom AMIs for common configurations).
Launching a new EC2 instance based on the AMI we created should take less time to become available than the instance launched in subsection 33 because we didn't need to install httpd again for this EC2 instance (because httpd was installed in our custom AMI).

```bash
#!/bin/bash
# Use this for your user data (script from top to bottom)
# install httpd (Linux 2 version)
echo "<h1>Hello World from $(hostname -f)</h1>" > /var/www/html/index.html
```

## Subsection 52. EC2 Instance Store

- EBS Volumes are network drives with good, but "limited", performance.
- If you ned more performant storage, you may use EC2 Instance Store, a hardware disk drive.
- EC2 Instance Store (ultimately) connects a hardware disk to your instance.
- EC2 Instance Store lose their storage if they are stopped (ephemeral).
- Recommended for use as a buffer, cache, scratch data, temporary content.
- Risk of data loss if hardware fails
- BACKUP AND REPLICATION ARE YOUR RESPONSIBILITY

Performance:

| Instance Size | 100% Random Read IOPS | Write IOPS  |
| ------------- | --------------------- | ----------- |
| i3.16xlarge   | 3.3 million           | 1.4 million |
Compared to 32k IOPS in an EBS gp2 volume.

## Subsection 53. EBS Volume Types

EBS Volumes come in 6 types:
1. gp2/gp3 (SSD):
	1. General Purpose SSD volume that balances price and performance for a wide variety of workloads.
	2. Can be used as **boot volumes**.
	3. Cost effective, low-latency
	4. May be used as System Boot Volumes, Development, and Test Environments.
	5. 1 GiB -16 TiB
	6. gp3:
		1. Baseline of 3,000 IOPS and throughput of 125 MiB/s
		2. Can increase IOPS up to 16,000 and throughput up to 1,000 MiB/s (independently)
	7. gp2:
		1. small gp2 volumes can burst IOPS to 3,000
		2. Size of the volume and IOPS are **linked**, max IOPS is 16,000
		3. 3 IOPS per GB, means at 5,334 GB we are at the max IOPS.
2. io1/io2 Block Express (SSD): 
	1. Provisioned IOPS (PIOPS) SSD
	2. Highest-performance SSD volume for mission-critical low-latency or high throughput workloads (more than 16,000 IOPS).
	3. Can be used as **boot volumes**.
	4. Great for ==**database== workloads** (sensitive to storage performance and consistency)
	5. io1 (4 GiB - 16 TiB):
		1. Max PIOPS: ==64,000 for Nitro EC2 instances== & 32,000 for other instances.
		2. Can increase PIOPS independently from storage size
	6. io2 Block Express (4 Gib - 64 TiB):
		1. Sub-millisecond latency
		2. Very high performance type of volume
		3. Max PIOPS: 256,000 with an IOPS:GiB ratio of 1,000:1
	7. Support EBS Multi-Attach
3. st1 (HDD): 
	1. Low cost HDD volume designed for frequently accessed, throughput-intensive workloads.
	2. Can NOT be used as boot volumes.
	3. 125 GiB to 16 TiB
	4. Throughput optimized
		1. Big Data, Data Warehouses, Log Processing
		2. Max throughput 500 MiB/s - max IOPS 500
4. sc1: (HDD):
	1. Lowest cost HDD volume designed for less frequently accessed workloads.
	2. Can NOT be used as boot volumes.
	3. Cold HDD (sc1):
		1. For data that is infrequently accessed 
		2. Scenarios where ==lowest cost== is important
		3. Max throughput 250 MiB/s - max IOPS 250

EBS Volumes are characterized in Size, Throughput, IOPS (I/O Ops Per Sec)

Summary of Storage Types
https://docs.aws.amazon.com/ebs/latest/userguide/ebs-volume-types.html#solid-state-drives

## Subsection 54. EBS Multi-attach

- io1/io2 volumes may be attached to multiple (==up to 16==) EC2 instances in the same AZ.
- Each instance would have full read & write permissions to the high performance volumes
- Use case:
	- Achieve higher application availability in clustered Linux applications (e.g., Teradata).
	- Application must manage concurrent write operations.
	
## Subsection 55. Amazon EFS

### Amazon Elastic File System (EFS)
- EFS is a managed network file system (NFS) that can be mounted on many EC2 instances.
- EFS may be mounted to EC2 instances in different AZs (multi-AZ).
- Highly available, scalable, ==expensive== (3x thte cost of gp2), pay per use.

1. Create your EFS file systems.
2. Place it in a security group.

Use cases:
- Content management
- Web serving
- data sharing
- Wordpress
Uses NFSv4.1 protocol
Uses security group to control access to EFS.
**Only compatible with Linux based AMI, not Windows.**
Encryption at rest using KMS
Uses the POSIX file system (a standard file system on Linux) and has a standard file API.
File system scales automatically, pay-per use (in GB), **no capacity planning!**

### Performance & Storage Classes
- 1000s of concurrent NFS clients, 10+ GB/s throughput
- May grow to Petabyte-scale network file system, automatically
Performance Mode (set at EFS creation time)
- General Purpose (default): Latency sensitive use-cases (web server, CMS, etc.)
- Max I/O: Higher latency, throughput, highly parallel (big data, media processing)
Throughput Mode
- Bursting: 1 TB = 50+ MiB/s bursts of up to 100 MiB/s
	- Bursting allows the throughput to scale with the amount of storage space used.
	- Throughput Modes:
		- General Purpose:
			- High performance and latency-sensitive applications.
		- Max I/O:
			- Designed for highly parallelized workloads that can tolerate higher latencies.
			- Good for Big Data
- Enhanced
	- Provisioned: 
		- Set your throughput regardless of the storage size (e.g., 1 GiB/s for 1 TB storage)
		- Paid for in advance
	- Elastic (recommended):
		- Automatically scale throughput up or down based on your workloads.
			- E.g., up to 3 GiB/s for reads and 1 GiB/s for writes.
			- Used for unpredictable workloads

### Storage Classes

An optimal storage class configuration can result in over 90% in cost savings.
#### Storage Tiers (lifecycle management feature - move files after N days)
- Standard: for frequently accessed files
- Infrequent access (EFS-IA): higher cost to retrieve files, lower price to store.
- Archive: rarely accessed data (few times each year), 50% cheaper

You may implement lifecycle policies to move files between storage tiers.
- e.g., move files that have not been accessed for 60 days to a new storage tier to reduce costs.

#### Availability and Durability
- Standard: Great for a Multi-AZ setup, great for Prod (resistance to disasters), Higher Availability and Durability
- One Zone: One AZ, lower-cost, great for dev, backup enabled by default, compatible with IA (EFS One Zone-IA)

## Subsection 56. EFS Hands on

### Set up EFS
1. AWS Console > EFS > Create file system
2. Choose a VPC.
3. Optional Steps
	1. Choose a File System Type (Regional or One Zone)
	2. Choose an AZ if using One Zone
	3. Enable/disable automatic backups
	4. Set Lifecycle Management Rules
	5. Set encryption
	6. Set performance settings (Elastic or Bursting)
4. Set Network Access Settings
	1. Choose a VPC
	2. Set mount targets
		1. Choose AZs
		2. Choose Subnet IDs
		3. Choose Security Groups
			1. If, at this point, you need to create a security group
				1. In a new tab, AWS Console > EC2 > Security Groups > Create security group
				2. Give the group a name (e.g., `efs-demo`)
				3. Give the group a description (e.g., `EFS Demo SG`)
				4. No inbound rules for this example.
				5. Create security group.
				6. Go back to the EFS Creation tab and reload it to load the new security group
				7. Get back to Remove the security group selection page, remove other security groups, and add the newly created security group for each AZ.
		4. Click Next
		5. Click Next to skip the File System Policy section
			1. This is advanced for this point in the class.
		6. Review settings and click Create
		7. Wait for file system to become available.

### Create EC2 Instances
1. Create an EC2 instance:
	1. AWS Console > EC2 > Launch instance
	2. Give it a name `Instance A`
	3. Use AWS Linux 2023
	4. Choose t3.micro (because it's free tier eligible)
	5. Disable the key pair for now.
	6. in Network settings, you may allow the firewall to create a new security group, which will allow SSH traffic from anywhere (0.0.0.0/0).
		1. Note the name of the security group.
	7. Configure Storage:
		1. Use 8GiB  gp2 storage
		2. click `edit` in the file system section
		3. You'll see an error ("...You must select a subnet before you can add an EFS file system.")
	8. Scroll back up to the Network Settings, and click `Edit`
	9. Select a subnet
	10. Go back to the Storage section
	11. Select EFS
	12. Click on `Add shared file system`
	13. The EFS file system will be selected under File system
	14. Leave the Mount point as it is for this example (`/mnt/efs/fs1`)
	15. Leave selected "Automatically create and attach security groups" and "Automatically mount shared file system by attaching required user data script".
	16. Click `Launch instance`
2. Create another instance. Use above steps except for the following:
	1. Name the instance `Instance 
	2. In the Network Settings, select a different subnet than the once selected for Instance A.
	3. Select the security group that was created when launching Instance A.
3. View all Instances and ensure both instances are running.

### EFS Status
1. AWS Console > EFS > select the volume > Select the EFS Network tab
	1. You'll notice that multiple security groups were added to each AZ for the file system.
		1. We added the `efs-demo` Security Group
		2. `efs-sg-1` and `efs-sg-2` Security Groups were automatically created by the EC2 Console for us and attached to our EFS file system.
2. AWS Console > EC2 > Security Groups > select a security group (e.g., `efs-sg-2`) > Inbound rules tab
	1. The rules allow NFS on port 2049 from the SG that is attached to Instance B if you selected `efs-sg-2`.

### Connect to EFS through an EC2 instance
1. AWS Console > EC2 > Click a checkbox to select Instance A > Click `Connect` at the top of the page.
2. Select EC2 Instance Connect
3. Repeat steps 1 and 2 for Instance B
4. In the Instance A terminal:
	1. run `ls /mnt/efs/fs1/` to verify the contents of the EFS volume
		1. It should be empty
	2. run `sudo su`
	3. run `echo "hello world" > /mnt/efs/fs1/hello.txt`
	4. run `cat /mnt/efs/fs1/hello.txt` to print the contents of the new file.
5. In the Instance B terminal:
	1. run `ls /mnt/efs/fs1/` to verify the contents of the EFS volume
		1. hello.txt should be listed
	2. run `cat /mnt/efs/fs1/hello.txt` to print the contents of the file created by Instance A.

In summary, the EFS volume is connected to both instances.

### Clean Up
1. AWS Console > EC2 > select all instances > click `Instance state` > select `Terminate (delete) instance`.
2. AWS Console > EFS > select the volume > click `Delete` at the top of the page.
3. Wait for the instances and volume to be deleted before you may proceed to the next step.
4. AWS Console > EC2 > Security Groups > delete all security groups created in this lecture.

## Subsection 57. EFS vs EBS

### EBS volumes:
- 1 instance at a time (except multi attach io1/io2)
- locked at the AZ level
- gp2: IO increases if the disk size increases
- gp3 and io: IO can increase independently
- Migrate EBS volumes:
	- create a snapshot & restore in another AZ
	- Backups use IO, so you shouldn't run them while your application is handling a lot of traffic because performance may be affected.
- Root gets terminated by default behavior may be disabled)
### EFS volumes:
- May be mounted to 100s of instances across AZs
- EFS share website files (WordPress)
- Only for Linux Instances (POSIX)
- Higher cost than EBS, but you may use storage tiers for cost savings.

## Subsection 58

Delete all AMIs, snapshots, instances, volumes, and security groups that we created in this section.


